---
layout:     post
title:      以太坊交易全流程：创建、签名、广播一步到位
date:       2025-09-04
header-img: img/post-bg-desk.jpg
catalog: true
---

> 如果你正准备把应用里的 **以太坊交易** 流程跑通，本文将带你从最基础的概念到一行行可运行的代码，手把手完成「创建 → 签名 → 广播」这三个关键环节。关键词以太坊交易、以太坊签名、sendTransaction、Sepolia、Alchemy SDK 将在文中自然高频出现，看完即可独立搞定链上转账。

---

## 快速预览：三步搞定以太坊交易

| 步骤 | 关键动作 | 核心关键词 |
|---|---|---|
| 1. 创建交易 | 组装交易对象（`to、value、gasLimit` 等） | 以太坊交易、交易对象 |
| 2. 签名交易 | 用私钥本地签名，生成 `rawTransaction` | 以太坊签名、签名 |
| 3. 广播交易 | 将已签名交易推送至节点，监听状态 | sendTransaction、广播 |

👉 [一文掌握以太坊交易三要素，防踩坑必读指南。](https://okxdog.com/)

---

## 准备工作

在开始动手之前，请确认你已具备：

- **MetaMask** 或其他以太坊钱包（用来获取私钥）
- **Node.js 18+** 与 **npm**
- 一个 **Alchemy 帐号**（Sepolia 节点免费额度）
- Sepolia 测试网地址并有一点测试 ETH（ faucet 领取见下文）

---

### 1. 申请 Sepolia 测试网 ETH

打开 [Sepolia Faucet 页面](https://sepoliafaucet.com/)：

1. **推特发文验证（仅测试网需要）**  
2. 填写 `0x` 开头的 **Sepolia 地址**，点击「Send Me ETH」  
3. 等待 1–2 分钟，检查 MetaMask 是否到帐

---

### 2. 初始化项目

在本地建立项目目录并安装依赖：

```bash
mkdir send-eth-demo && cd send-eth-demo
npm init -y
npm install alchemy-sdk dotenv
```

---

### 3. 设置环境变量 `.env`

```bash
# .env
ALCHEMY_API_KEY="替换为真实Alchemy Web3 KEY"
PRIVATE_KEY="替换为你的MetaMask私钥(去掉0x前缀)"
```

安全提示：**PRIVATE_KEY** 绝对不要推到 GitHub，可一并把 `.env` 加入 `.gitignore`。

---

### 4. 编写核心代码 `sendTx.js`

```javascript
// sendTx.js
require('dotenv').config();
const { Alchemy, Network, Wallet, Utils } = require('alchemy-sdk');

const settings = {
  apiKey: process.env.ALCHEMY_API_KEY,
  network: Network.ETH_SEPOLIA,
};

const alchemy = new Alchemy(settings);
const wallet = new Wallet(process.env.PRIVATE_KEY);

async function main() {
  // 1. 查询当前nonce，避免重放
  const nonce = await alchemy.core.getTransactionCount(wallet.address, 'latest');

  // 2. 构建交易对象
  const transaction = {
    to: '0xb856DB870bAfd0A9b347529F2285A530B73CAf8f', // 返回faucet
    value: Utils.parseEther('0.01'),                  // 0.01 SepoliaETH
    gasLimit: 21000,
    maxFeePerGas: Utils.parseUnits('30', 'gwei'),
    maxPriorityFeePerGas: Utils.parseUnits('1', 'gwei'),
    nonce,
    type: 2,                                          // EIP-1559交易
  };

  // 3. 签名
  const rawTx = await wallet.signTransaction(transaction);

  // 4. 广播
  const txResponse = await alchemy.core.sendTransaction(rawTx);
  console.log(`已广播交易哈希: ${txResponse.hash}`);
}

main().catch(console.error);
```

---

### 5. 运行并追踪交易

```bash
node sendTx.js
```

输出示例：

```
已广播交易哈希: 0xac11d5e8...
```

开箱即用的 Mempool 监控体验 👉 [亲自体验交易实时状态的快感！](https://okxdog.com/)

前往 **Alchemy Dashboard → Mempool**，选择刚才创建的 Sepolia App，把「Status」切到 **All**，即可看到：

- `Pending` → `Mined` 的实时变化
- 点击 txHash 可直达区块浏览器 **Etherscan Sepolia**

---

## 常见疑问解答（FAQ）

Q1：Alchemy 也会保存我的私钥吗？  
A：不会。所有签名都在本地发生，Alchemy 节点只负责广播已签名数据，降低中心化风险。

Q2：如果不想把私钥写到 `.env`，还有哪些方案？  
A：推荐使用 **Keystore 文件 + 密码**、**硬件钱包（Ledger/Trezor）** 或 **AWS KMS** 这类托管密钥服务。

Q3：为何需要 `nonce`？  
A：`nonce` 记录账户历史交易次数，可防止交易被重放攻击，也可用来控制交易顺序。

Q4：测试网用量太大会被封吗？  
A：正常开发流量不会触发限制；如果超过免费额度，可在控制台自助升级。

Q5：如何分辨 **Gas Price** 与 **Max Fee**？  
A：`maxFeePerGas = baseFee + maxPriorityFeePerGas`，前者是 **你想支付的上限**，后者是 **直接给矿工的小费**。二者合理设置可省下大量费用。

---

## 进阶玩法

完成一次转账只是开始，下一步可以尝试：

- 部署可升级智能合约：参考官方教程《Hello World 智能合约》  
- 监听事件：用 WebSocket Provider 订阅 `Pending` 和 `Mined` 交易，实现实时推送  
- 多签钱包集成：将 `Wallet` 改为 `MultisigWallet`，降低私钥单点风险

---

恭喜你，现在已能独立并安全地完成「创建-签名-广播」的完整以太坊交易流程。把今天的实战脚本稍加改造，就能对接生产环境、ERC-20 转账、NFT 铸造等高级场景。祝你开发顺利！