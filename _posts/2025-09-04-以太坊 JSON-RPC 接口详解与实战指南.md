---
layout:     post
title:      以太坊 JSON-RPC 接口详解与实战指南
date:       2025-09-04
header-img: img/post-bg-desk.jpg
catalog: true
---

> 本文聚焦以太坊 JSON-RPC，帮助你快速掌握协议原理、节点配置与常见调用场景。

## 以太坊 JSON-RPC 是什么？

JSON（JavaScript Object Notation）是一种轻量级数据交换格式；JSON-RPC 则是基于 JSON 的无状态远程过程调用协议。它定义的只是数据结构与处理规则，并不限定具体传输载体——无论是进程内通信、socket、HTTP，还是消息队列都可以使用。  
以太坊客户端（如 Geth、Parity、Erigon 等）都通过 JSON-RPC 对外暴露区块链查询、交易发送、订阅事件等能力，因此周密理解 **以太坊 JSON-RPC** 是每一位开发者迈入链上世界的第一步。

关键词：以太坊、JSON-RPC、节点、Geth、端点、CORS、Parity

---

## 常用客户端与默认端点

| 客户端类型 | 默认地址/端口 | 备注 |
| --- | --- | --- |
| C++ (eth) | http://localhost:8545 | 需显式开启 `-j` 参数 |
| Go (Geth) | http://localhost:8545 | 默认启用 `--rpc` 时监听该端口 |
| Python (Py-ethapp) | http://localhost:4000 | 默认自动开启 |
| Parity | http://localhost:8545 | 与 Geth 端口同源，利于本地开发 |

如果你本地同时运行多种客户端，最好在 `~/.bashrc` 里给不同端口做别名，避免冲突。

---

## Go-Geth 节点实战

### 一键启动 HTTP JSON-RPC

```bash
geth --rpc
```
默认 IP 和端口分别为 `localhost:8545`。如需修改，可追加 `--rpcaddr` 与 `--rpcport`：

示例：把端口改为 8745，同时监听所有网卡，以便局域网调试：

```bash
geth --rpc --rpcaddr 0.0.0.0 --rpcport 8745
```

### 解决 CORS 跨域限制

若想在前端 DApp 中调用节点，跨域问题必须解决。最简单的方法是指定可信任的域名：

```bash
geth --rpc --rpccorsdomain "http://localhost:3000,https://yourdapp.com"
```

> 仅用于开发和测试环境。生产环境中建议用反向代理加白名单策略。

### 动态开启 RPC

在 `geth attach` 的环境下随时开关：

```js
> admin.startRPC("0.0.0.0", 8745)
> admin.stopRPC()
```

---

## C++ 客户端配置

C++ 实现（早期称为 eth 或 cpp-ethereum）通过 `-j` 显式开启 RPC：

```bash
./eth -j
```

如需换端口：

```bash
./eth -j --json-rpc-port 8079
```

---

## Python 实现

pyethapp 默认地把 JSON-RPC 服务绑在 `127.0.0.1:4000`，可通过配置项调整：

```bash
pyethapp -c jsonrpc.listen_host=127.0.0.5 -c jsonrpc.listen_port=6060 run
```

---

## 必须掌握的核心调用

以下 6 组调用覆盖了开发中最常用的链上交互场景：

1. eth_blockNumber — 获取最新区块高度。  
2. eth_getBalance — 查询某地址 ETH 余额。  
3. eth_getTransactionReceipt — 获取交易回执，确认是否上链。  
4. eth_estimateGas — 估算调用合约所需 gas，防止余量不足。  
5. eth_call — 只读调用方法，不消耗 gas。  
6. eth_sendRawTransaction — 广播已签名的交易。

保持统一风格进行一次简单调用示例（使用 curl 访问本地 8545 端口）：

```bash
curl -X POST "http://localhost:8545" \
  -H "Content-Type: application/json" \
  --data '{"jsonrpc":"2.0","method":"eth_blockNumber","params":[],"id":1}'
```

返回示例：

```json
{"jsonrpc":"2.0","id":1,"result":"0x1234"}
```

---

## 常见问题与解答（FAQ）

Q1：为什么使用浏览器请求节点时报告 `Access control check failed`？  
A：没有在启动参数里设置 `--rpccorsdomain`。只需把前端域名列入白名单即可。

Q2：能直接暴露在公网吗？  
A：不建议。公网暴露的 JSON-RPC 无鉴权，容易成为攻击入口。可用 Nginx + Basic Auth 或更高级的反向代理方案。

Q3：为什么 `eth_accounts` 返回空数组？  
A：本地钱包没有账户或未解锁。使用 `personal.newAccount()` 创建或用 `personal.unlockAccount(address, PW, 300)` 解锁。

Q4：查询 ERC-20 余额时需要额外依赖吗？  
A：需要合约 ABI 与代币合约地址；您可以在👉 [**一文吃透 ERC-20 标准与合约调用**](https://okxdog.com/) 中查看到完整示例。

Q5：Geth 日志里出现 `INFO [06-29|12:34:56] IPC endpoint closed`，是节点崩溃吗？  
A：非崩溃，只是 IPC 通信被关闭；若 HTTP-RPC 端口仍监听到请求，不影响应用运行。

Q6：如何监控节点同步状态？  
A：通过调用 `eth_syncing`，判断返回布尔值即可；或者直接在控制台执行 `web3.eth.isSyncing()`。

---

## 进阶场景：批量查询与订阅

### 用批请求节省往返

以太坊轻量级库（web3.js、ethers.js、web3.py 等）都支持把多个 JSON-RPC 请求压缩到单次 TCP 往返，有效提升性能。示例：

```bash
curl -X POST "http://localhost:8545" \
  -H "Content-Type: application/json" \
  --data '[
    {"jsonrpc":"2.0","id":1,"method":"eth_getBalance","params":["0x...", "latest"]},
    {"jsonrpc":"2.0","id":2,"method":"eth_getTransactionCount","params":["0x...", "latest"]}
  ]'
```

### 实验性质的 pub/sub

Geth ≥1.4、Parity ≥1.6 支持基于 websocket 的实时推送：当链上产生新区块、新交易或日志事件时，服务端会向浏览器或服务器主动推送数据。

```bash
geth --ws --ws.addr "0.0.0.0" --ws.port 8546 --ws.origins "*"
```

前端即可通过 `new WebSocket("ws://localhost:8546")` 进行订阅，`eth_subscribe` 关键字可监听 `newHeads`、`newPendingTransactions`、`logs` 等频道。

---

## 上线前的最后一步：防护与监控

- 使用 **systemd** 管理 geth 服务，定期重载、自动重启。  
- 日志级别 `--verbosity 3` 可在出现问题时迅速定位。  
- 网络层防火墙只对外开放必要的端口，边车用 **fail2ban** 禁止暴力破解。  
- 关键 RPC 节点应部署 **HTTPS/Wss** 外加鉴权Token，确保链路加密。  

👉 [零停机部署及节点高可用方案，这份指南别错过](https://okxdog.com/) 为你准备了模板化的脚本与示例配置文件，照着做即可。

---

## 总结

掌握以太坊 JSON-RPC 的核心在于：  
1. 明确每个调用的能力与边界；  
2. 会调配端口、CORS 与防火墙；  
3. 用批请求或 websocket 订阅提高实时性与吞吐量。  

无论你是写 Solidity 合约，还是做 DApp 前端，**以太坊节点** 就是与链对话的唯一桥梁。把 JSON-RPC 接口用熟，链上世界的无限可能即刻向你敞开。